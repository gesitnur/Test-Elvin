{"ast":null,"code":"var ee = require('namespace-emitter');\nmodule.exports = /*#__PURE__*/function () {\n  function UppySocket(opts) {\n    this.opts = opts;\n    this._queued = [];\n    this.isOpen = false;\n    this.emitter = ee();\n    this._handleMessage = this._handleMessage.bind(this);\n    this.close = this.close.bind(this);\n    this.emit = this.emit.bind(this);\n    this.on = this.on.bind(this);\n    this.once = this.once.bind(this);\n    this.send = this.send.bind(this);\n    if (!opts || opts.autoOpen !== false) {\n      this.open();\n    }\n  }\n  var _proto = UppySocket.prototype;\n  _proto.open = function open() {\n    var _this = this;\n    this.socket = new WebSocket(this.opts.target);\n    this.socket.onopen = function (e) {\n      _this.isOpen = true;\n      while (_this._queued.length > 0 && _this.isOpen) {\n        var first = _this._queued[0];\n        _this.send(first.action, first.payload);\n        _this._queued = _this._queued.slice(1);\n      }\n    };\n    this.socket.onclose = function (e) {\n      _this.isOpen = false;\n    };\n    this.socket.onmessage = this._handleMessage;\n  };\n  _proto.close = function close() {\n    if (this.socket) {\n      this.socket.close();\n    }\n  };\n  _proto.send = function send(action, payload) {\n    // attach uuid\n    if (!this.isOpen) {\n      this._queued.push({\n        action: action,\n        payload: payload\n      });\n      return;\n    }\n    this.socket.send(JSON.stringify({\n      action: action,\n      payload: payload\n    }));\n  };\n  _proto.on = function on(action, handler) {\n    this.emitter.on(action, handler);\n  };\n  _proto.emit = function emit(action, payload) {\n    this.emitter.emit(action, payload);\n  };\n  _proto.once = function once(action, handler) {\n    this.emitter.once(action, handler);\n  };\n  _proto._handleMessage = function _handleMessage(e) {\n    try {\n      var message = JSON.parse(e.data);\n      this.emit(message.action, message.payload);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n  return UppySocket;\n}();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}